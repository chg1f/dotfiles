#!/bin/bash

set -ex

case "$1" in
"hooks.apply.*") ;;
*)
	if command -v chezmoi >/dev/null 2>&1; then
		chezmoi apply
	fi
	;;
esac

if command -v yay >/dev/null 2>&1; then
	yay -S --needed - <"$HOME/.config/yay/pkglist.txt" && yay -Yc
fi

if command -v brew >/dev/null 2>&1; then
	brew bundle
	brew upgrade
fi

if command -v nvim >/dev/null 2>&1; then
	nvim --headless "+Lazy! sync" +qa
fi

if [[ -x "$HOMEBREW_PREFIX/opt/tpm/share/tpm/bin/update_plugins" ]]; then
	"$HOMEBREW_PREFIX/opt/tpm/share/tpm/bin/update_plugins" all
fi

if command -v zimfw >/dev/null 2>&1; then
	zimfw update
fi
